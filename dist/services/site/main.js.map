{"version":3,"file":"main.js","mappings":";;;;;;;;;;AAAA,sFAA4B;;;;;;;;;;;ACK5B,MAAa,WAAW;IAMtB,YAAY,OAAe,EAAE,UAAU,GAAG,GAAG,EAAE,UAA8B,EAAE;QAC7E,MAAM,EAAE,gBAAgB,EAAE,WAAW,EAAE,GAAG,OAAO;QACjD,IAAI,CAAC,OAAO,GAAG,OAAO;QACtB,IAAI,CAAC,UAAU,GAAG,UAAU;QAC5B,IAAI,CAAC,gBAAgB,GAAG,gBAAgB;QACxC,IAAI,CAAC,WAAW,GAAG,WAAW;IAChC,CAAC;CACF;AAbD,kCAaC;;;;;;;;;;AClBD,MAAM,MAAM,GAAG;IACb,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ;IAC7B,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC;IAC3C,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC;IACzC,aAAa,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;IACzC,MAAM,EAAE;QACN,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY;QAC/B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,WAAW;QAC7B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,WAAW;KAC9B;IACD,OAAO,EAAE;QACP,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;QAC7B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS;QAC3B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS,IAAI,IAAI;QACnC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;KAC9B;IACD,QAAQ,EAAE;QACR,GAAG,EAAE;YACH,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS;YAC5B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ;YAC1B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ;SAC3B;QACD,IAAI,EAAE;YACJ,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;YAC7B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS;YAC3B,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS;SAC5B;KACF;IACD,MAAM,EAAE;QACN,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAgB;QACtC,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAC9C,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAC5C,YAAY,EAAE,8BAA8B;KAC7C;IACD,OAAO,EAAE;QACP,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB;QACvC,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB;QAC/C,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAC7C,KAAK,EAAE,gBAAgB;QACvB,YAAY,EAAE,0CAA0C;QACxD,QAAQ,EAAE,sCAAsC;QAChD,WAAW,EAAE,mCAAmC;KACjD;IACD,SAAS,EAAE;QACT,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,gCAAgC;QAC9D,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,6BAA6B;QAC3D,kBAAkB,EAAE,OAAO,CAAC,GAAG,CAAC,+BAA+B;QAC/D,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,gCAAgC;KACxF;CACF;AAED,qBAAe,MAAM;;;;;;;;;;;AClDrB,mEAAwC;AAExC;;;;;;;;GAQG;AACI,MAAM,KAAK,GAAG,CAAC,GAA4B,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACrG,IAAI,WAAW,GAAG,GAAG;IAErB,IAAI,CAAC,CAAC,GAAG,YAAY,oBAAW,CAAC,EAAE;QACjC,WAAW,GAAG,IAAI,oBAAW,CAAC,GAAG,CAAC,OAAO,CAAC;KAC3C;IAED,OAAO,CAAC,KAAK,CAAC,WAAW,CAAC;IAC1B,GAAG,CAAC,MAAM,CAAE,WAA2B,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;AACvE,CAAC;AATY,aAAK,SASjB;;;;;;;;;;;ACrBD,8FAAuB;;;;;;;;;;;ACAvB,4EAA8B;AAE9B,MAAM,MAAM,GAAG,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,KAAK,GAAG,IAAI,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,KAAK,MAAM;AAE3E,WAAG,GAAG;IACjB,IAAI,EAAE,MAAM;IACZ,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,MAAM,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,IAAI,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,MAAM;IACpG,MAAM;CACP;;;;;;;;;;;ACRD,4EAA8B;AAE9B,MAAM,MAAM,GAAG,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,KAAK,GAAG,IAAI,gBAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,KAAK,MAAM;AAE3E,YAAI,GAAG;IAClB,IAAI,EAAE,OAAO;IACb,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,MAAM,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,OAAO;IACvG,MAAM;CACP;;;;;;;;;;;ACRD,yFAAqB;AACrB,0FAAsB;;;;;;;;ACDtB;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;ACtBA,+CAAkC;AAClC,uDAA0C;AAC1C,6EAAsE;AACtE,yCAA4B;AAC5B,2CAA8B;AAC9B,yCAA4B;AAC5B,uCAA6C;AAC7C,6CAAgC;AAChC,2CAA8B;AAC9B,8EAAqC;AAErC,oFAAoC;AACpC,4EAA6B;AAE7B,IAAI,UAAU;AACd,IAAI,WAAW;AAEf,MAAM,GAAG,GAAG,OAAO,EAAE;AAErB,UAAU;AACV,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAEtB,cAAc;AACd,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;AAEtB,UAAU;AACV,IAAI,gBAAM,CAAC,OAAO,CAAC,KAAK,EAAE;IACxB,MAAM,OAAO,GAAG,EAAE,GAAG,EAAH,aAAG,EAAE,IAAI,EAAJ,cAAI,EAAE;IAC7B,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,EAAE;QAC3C,GAAG,CAAC,GAAG,CAAC,iDAAK,EAAC,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;QACvE,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;IACjE,CAAC,CAAC;CACH;AAED,SAAS;AACT,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;AAExD,aAAa;AACb,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;IACxB,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,oBAAoB,CAAC,CAAC;AAC1D,CAAC,CAAC;AAEF,QAAQ;AACR,GAAG,CAAC,GAAG,CAAC,kBAAK,CAAC;AAEd,MAAM,IAAI,GAAG,gBAAM,CAAC,OAAO,CAAC,IAAI;AAEhC,IAAI,gBAAM,CAAC,OAAO,CAAC,KAAK,KAAK,GAAG,IAAI,gBAAM,CAAC,OAAO,CAAC,KAAK,KAAK,MAAM,EAAE;IACnE,gBAAgB;IAChB,MAAM,UAAU,GAAG,mBAAU,EAAC,4BAA4B,CAAC,CAAC,CAAC,CAAC,qBAAY,EAAC,4BAA4B,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE;IACrH,MAAM,WAAW,GAAG,mBAAU,EAAC,8BAA8B,CAAC,CAAC,CAAC,CAAC,qBAAY,EAAC,8BAA8B,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE;IAC1H,MAAM,WAAW,GAAG,EAAE,GAAG,EAAE,UAAU,EAAE,IAAI,EAAE,WAAW,EAAE;IAE1D,4CAA4C;IAC5C,WAAW,GAAG,KAAK,CAAC,YAAY,CAAC,WAAW,EAAE,GAAG,CAAC;IAElD,MAAM,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE,CAC3C,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,wBAAwB,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,IAAI,IAAI,EAAE,CAAC,CAAC,CACjH;IACD,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC;CAClC;KAAM;IACL,uCAAuC;IACvC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC;IACnC,MAAM,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE,CAC1C,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,uBAAuB,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,IAAI,IAAI,EAAE,CAAC,CAAC,CAChH;IACD,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC;CAClC","sources":["webpack://fl/./libs/errors/src/index.ts","webpack://fl/./libs/errors/src/lib/errors.ts","webpack://fl/./services/site/src/config/index.ts","webpack://fl/./services/site/src/middleware/error.ts","webpack://fl/./services/site/src/middleware/index.ts","webpack://fl/./services/site/src/proxies/api.ts","webpack://fl/./services/site/src/proxies/auth.ts","webpack://fl/./services/site/src/proxies/index.ts","webpack://fl/external commonjs \"chalk\"","webpack://fl/external commonjs \"compression\"","webpack://fl/external commonjs \"express\"","webpack://fl/external commonjs \"http-proxy-middleware\"","webpack://fl/external commonjs \"morgan\"","webpack://fl/external commonjs \"tslib\"","webpack://fl/external node-commonjs \"fs\"","webpack://fl/external node-commonjs \"http\"","webpack://fl/external node-commonjs \"https\"","webpack://fl/external node-commonjs \"path\"","webpack://fl/webpack/bootstrap","webpack://fl/./services/site/src/main.ts"],"sourcesContent":["export * from './lib/errors'\n","export interface CustomErrorOptions {\n  errorDescription?: string\n  errorCauses?: string[]\n}\n\nexport class CustomError {\n  message!: string\n  statusCode!: number\n  errorDescription!: string\n  errorCauses!: string[]\n\n  constructor(message: string, statusCode = 500, options: CustomErrorOptions = {}) {\n    const { errorDescription, errorCauses } = options\n    this.message = message\n    this.statusCode = statusCode\n    this.errorDescription = errorDescription\n    this.errorCauses = errorCauses\n  }\n}\n","const config = {\n  siteUrl: process.env.SITE_URL,\n  siteJWKS: JSON.parse(process.env.SITE_JWKS),\n  siteIKS: JSON.parse(process.env.SITE_IKS),\n  sessionSecret: process.env.SESSION_SECRET,\n  server: {\n    https: process.env.SERVER_HTTPS,\n    host: process.env.SERVER_HOST,\n    port: process.env.SERVER_PORT\n  },\n  service: {\n    https: process.env.SITE_HTTPS,\n    host: process.env.SITE_HOST,\n    port: process.env.SITE_PORT || 4330,\n    proxy: process.env.SITE_PROXY\n  },\n  services: {\n    api: {\n      https: process.env.API_HTTPS,\n      host: process.env.API_HOST,\n      port: process.env.API_PORT\n    },\n    auth: {\n      https: process.env.AUTH_HTTPS,\n      host: process.env.AUTH_HOST,\n      port: process.env.AUTH_PORT\n    }\n  },\n  google: {\n    clientId: process.env.GOOGLE_CLIENT_ID,\n    clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n    redirectUrl: process.env.GOOGLE_REDIRECT_URL,\n    discoveryUrl: 'https://accounts.google.com/'\n  },\n  discord: {\n    clientId: process.env.DISCORD_CLIENT_ID,\n    clientSecret: process.env.DISCORD_CLIENT_SECRET,\n    redirectUrl: process.env.DISCORD_REDIRECT_URL,\n    scope: 'identify email',\n    authorizeUrl: 'https://discord.com/api/oauth2/authorize',\n    tokenUrl: 'https://discord.com/api/oauth2/token',\n    userInfoUrl: 'https://discord.com/api/users/@me'\n  },\n  challonge: {\n    'Format Library': process.env.CHALLONGE_FORMAT_LIBRARY_API_KEY, // formatLibraryChallongeAPIKey or challongeAPIKeys.'Format Library'\n    'GoatFormat.com': process.env.CHALLONGE_GOAT_FORMAT_API_KEY, // goatformatChallongeAPIKey or challongeAPIKeys.'GoatFormat.com'\n    'EdisonFormat.com': process.env.CHALLONGE_EDISON_FORMAT_API_KEY, // challongeAPIKeys.'EdisonFormat.com'\n    'Crows Nest': process.env.CHALLONGE_CROWS_NEST_API_KEY // challongeAPIKeys.'Crows Nest'\n  }\n}\n\nexport default config\n","import { Request, Response, NextFunction } from 'express'\nimport { CustomError } from '@fl/errors'\n\n/**\n * Custom error middleware to standardize error objects returned to\n * the client\n *\n * @param err Error caught by Express.js\n * @param req Request object provided by Express\n * @param res Response object provided by Express\n * @param next NextFunction function provided by Express\n */\nexport const error = (err: TypeError | CustomError, req: Request, res: Response, next: NextFunction) => {\n  let customError = err\n\n  if (!(err instanceof CustomError)) {\n    customError = new CustomError(err.message)\n  }\n\n  console.error(customError)\n  res.status((customError as CustomError).statusCode).send(customError)\n}\n","export * from './error'\n","import config from '../config'\n\nconst secure = config.services.api.https === '1' || config.services.api.https === 'true'\n\nexport const api = {\n  path: '/api',\n  target: `${secure ? 'https' : 'http'}://${config.services.api.host}:${config.services.api.port}/api`,\n  secure\n}\n","import config from '../config'\n\nconst secure = config.services.api.https === '1' || config.services.api.https === 'true'\n\nexport const auth = {\n  path: '/auth',\n  target: `${secure ? 'https' : 'http'}://${config.services.auth.host}:${config.services.auth.port}/auth`,\n  secure\n}\n","export * from './api'\nexport * from './auth'\n","module.exports = require(\"chalk\");","module.exports = require(\"compression\");","module.exports = require(\"express\");","module.exports = require(\"http-proxy-middleware\");","module.exports = require(\"morgan\");","module.exports = require(\"tslib\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as express from 'express'\nimport * as compression from 'compression'\nimport { createProxyMiddleware as proxy } from 'http-proxy-middleware'\nimport * as http from 'http'\nimport * as https from 'https'\nimport * as path from 'path'\nimport { existsSync, readFileSync } from 'fs'\nimport * as morgan from 'morgan'\nimport * as chalk from 'chalk'\nimport { api, auth } from './proxies'\n\nimport { error } from './middleware'\nimport config from './config'\n\nlet httpServer\nlet httpsServer\n\nconst app = express()\n\n// logging\napp.use(morgan('dev'))\n\n// compression\napp.use(compression())\n\n// proxies\nif (config.service.proxy) {\n  const proxies = { api, auth }\n  Object.entries(proxies).forEach(([, prxy]) => {\n    app.use(proxy(prxy.path, { target: prxy.target, secure: prxy.secure }))\n    console.log(chalk.cyan(`Proxy ${prxy.path} to ${prxy.target}`))\n  })\n}\n\n// assets\napp.use(express.static(path.join(__dirname, '/assets')))\n\n// index.html\napp.use('*', (req, res) => {\n  res.sendFile(path.join(__dirname, '/assets/index.html'))\n})\n\n// error\napp.use(error)\n\nconst port = config.service.port\n\nif (config.service.https === '1' || config.service.https === 'true') {\n  // load key/cert\n  const privateKey = existsSync('../../../certs/privkey.pem') ? readFileSync('../../../certs/privkey.pem', 'utf8') : ''\n  const certificate = existsSync('../../../certs/fullchain.pem') ? readFileSync('../../../certs/fullchain.pem', 'utf8') : ''\n  const credentials = { key: privateKey, cert: certificate }\n\n  // Wrap(proxy) http server with https server\n  httpsServer = https.createServer(credentials, app)\n\n  const server = httpsServer.listen(port, () =>\n    console.log(chalk.cyan(`Listening on https://${config.service.host ? config.service.host : '0.0.0.0'}:${port}`))\n  )\n  server.on('error', console.error)\n} else {\n  // Wrap(proxy) express with http server\n  httpServer = http.createServer(app)\n  const server = httpServer.listen(port, () =>\n    console.log(chalk.cyan(`Listening on http://${config.service.host ? config.service.host : '0.0.0.0'}:${port}`))\n  )\n  server.on('error', console.error)\n}\n"],"names":[],"sourceRoot":""}